<?xml version="1.0" encoding="utf-8"?>
<html MadCap:timeEstimate="0" MadCap:priority="0" MadCap:status="In Progress" MadCap:lastBlockDepth="5" MadCap:lastHeight="784" MadCap:lastWidth="624" xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
    <head>
        <link href="../../../Resources/Stylesheets/ApteanOLH.css" rel="stylesheet" type="text/css" />
    </head>
    <body>
        <head><title>Maintaining Onyx Enterprise Database </title>
            <link href="../../Resources/Stylesheets/ApteanOLH.css" rel="stylesheet" type="text/css" />
        </head>
        <h2>Maintaining Onyx Enterprise Database </h2>
        <p>Maintaining the Onyx Enterprise Database involves performing regular 
 maintenance of statistics and indexes on the Onyx transactional tables. 
 This maintenance supports optimum performance of the database. </p>
        <p MadCap:conditions="Default.Obsolete" class="BodyText" style="font-weight: bold;">List of transactional tables</p>
        <table width="40%" MadCap:conditions="Default.Obsolete">
            <tr>
                <th>Transactional tables</th>
            </tr>
            <tr>
                <td>
                    <p class="Table_Text">action_batch</p>
                </td>
            </tr>
            <tr>
                <td>
                    <p class="Table_Text">address</p>
                </td>
            </tr>
            <tr>
                <td>
                    <p class="Table_Text">alert</p>
                </td>
            </tr>
            <tr>
                <td>
                    <p class="Table_Text">appointment</p>
                </td>
            </tr>
            <tr>
                <td>
                    <p class="Table_Text">appointment_association</p>
                </td>
            </tr>
            <tr>
                <td>
                    <p class="Table_Text">appointment_attendee</p>
                </td>
            </tr>
            <tr>
                <td>
                    <p class="Table_Text">assignment_association</p>
                </td>
            </tr>
            <tr>
                <td>
                    <p class="Table_Text">batch_source_list_status</p>
                </td>
            </tr>
            <tr>
                <td>
                    <p class="Table_Text">company</p>
                </td>
            </tr>
            <tr>
                <td>
                    <p class="Table_Text">email_address</p>
                </td>
            </tr>
            <tr>
                <td>
                    <p class="Table_Text">email_association</p>
                </td>
            </tr>
            <tr>
                <td>
                    <p class="Table_Text">email_attachment</p>
                </td>
            </tr>
            <tr>
                <td>
                    <p class="Table_Text">email_contact</p>
                </td>
            </tr>
            <tr>
                <td>
                    <p class="Table_Text">email_message</p>
                </td>
            </tr>
            <tr>
                <td>
                    <p class="Table_Text">email_user_association</p>
                </td>
            </tr>
            <tr>
                <td>
                    <p class="Table_Text">external_contact</p>
                </td>
            </tr>
            <tr>
                <td>
                    <p class="Table_Text">external_user</p>
                </td>
            </tr>
            <tr>
                <td>
                    <p class="Table_Text">file_link</p>
                </td>
            </tr>
            <tr>
                <td>
                    <p class="Table_Text">filter_detail</p>
                </td>
            </tr>
            <tr>
                <td>
                    <p class="Table_Text">filter_header</p>
                </td>
            </tr>
            <tr>
                <td>
                    <p class="Table_Text">forecast_detail</p>
                </td>
            </tr>
            <tr>
                <td>
                    <p class="Table_Text">forecast_header</p>
                </td>
            </tr>
            <tr>
                <td>
                    <p class="Table_Text">incident</p>
                </td>
            </tr>
            <tr>
                <td>
                    <p class="Table_Text">incident_audit_log</p>
                </td>
            </tr>
            <tr>
                <td>
                    <p class="Table_Text">individual</p>
                </td>
            </tr>
            <tr>
                <td>
                    <p class="Table_Text">internal_contact</p>
                </td>
            </tr>
            <tr>
                <td>
                    <p class="Table_Text">key_word</p>
                </td>
            </tr>
            <tr>
                <td>
                    <p class="Table_Text">key_word_association</p>
                </td>
            </tr>
            <tr>
                <td>
                    <p class="Table_Text">literature_message</p>
                </td>
            </tr>
            <tr>
                <td>
                    <p class="Table_Text">literature_order_batch</p>
                </td>
            </tr>
            <tr>
                <td>
                    <p class="Table_Text">literature_order_detail</p>
                </td>
            </tr>
            <tr>
                <td>
                    <p class="Table_Text">literature_order_header</p>
                </td>
            </tr>
            <tr>
                <td>
                    <p class="Table_Text">match_code_value</p>
                </td>
            </tr>
            <tr>
                <td>
                    <p class="Table_Text">merge_address_history</p>
                </td>
            </tr>
            <tr>
                <td>
                    <p class="Table_Text">merge_company_history</p>
                </td>
            </tr>
            <tr>
                <td>
                    <p class="Table_Text">merge_customer_id_history</p>
                </td>
            </tr>
            <tr>
                <td>
                    <p class="Table_Text">merge_data_history</p>
                </td>
            </tr>
            <tr>
                <td>
                    <p class="Table_Text">merge_individual_history</p>
                </td>
            </tr>
            <tr>
                <td>
                    <p class="Table_Text">merge_phone_history</p>
                </td>
            </tr>
            <tr>
                <td>
                    <p class="Table_Text">merge_template</p>
                </td>
            </tr>
            <tr>
                <td>
                    <p class="Table_Text">message</p>
                </td>
            </tr>
            <tr>
                <td>
                    <p class="Table_Text">message_destination</p>
                </td>
            </tr>
            <tr>
                <td>
                    <p class="Table_Text">note</p>
                </td>
            </tr>
            <tr>
                <td>
                    <p class="Table_Text">owner_association</p>
                </td>
            </tr>
            <tr>
                <td>
                    <p class="Table_Text">owner_campaign</p>
                </td>
            </tr>
            <tr>
                <td>
                    <p class="Table_Text">owner_campaign_detail</p>
                </td>
            </tr>
            <tr>
                <td>
                    <p class="Table_Text">owner_question_response</p>
                </td>
            </tr>
            <tr>
                <td>
                    <p class="Table_Text">owner_survey_association</p>
                </td>
            </tr>
            <tr>
                <td>
                    <p class="Table_Text">partner</p>
                </td>
            </tr>
            <tr>
                <td>
                    <p class="Table_Text">partner_access</p>
                </td>
            </tr>
            <tr>
                <td>
                    <p class="Table_Text">partner_group</p>
                </td>
            </tr>
            <tr>
                <td>
                    <p class="Table_Text">partner_group_access</p>
                </td>
            </tr>
            <tr>
                <td>
                    <p class="Table_Text">partner_user</p>
                </td>
            </tr>
            <tr>
                <td>
                    <p class="Table_Text">phone</p>
                </td>
            </tr>
            <tr>
                <td>
                    <p class="Table_Text">product_detail</p>
                </td>
            </tr>
            <tr>
                <td>
                    <p class="Table_Text">product_header</p>
                </td>
            </tr>
            <tr>
                <td>
                    <p class="Table_Text">quote_detail</p>
                </td>
            </tr>
            <tr>
                <td>
                    <p class="Table_Text">quote_header</p>
                </td>
            </tr>
            <tr>
                <td>
                    <p class="Table_Text">reminder</p>
                </td>
            </tr>
            <tr>
                <td>
                    <p class="Table_Text">script_session</p>
                </td>
            </tr>
            <tr>
                <td>
                    <p class="Table_Text">script_session_prompt_response</p>
                </td>
            </tr>
            <tr>
                <td>
                    <p class="Table_Text">script_session_step</p>
                </td>
            </tr>
            <tr>
                <td>
                    <p class="Table_Text">search_query</p>
                </td>
            </tr>
            <tr>
                <td>
                    <p class="Table_Text">subscription_id_map</p>
                </td>
            </tr>
            <tr>
                <td>
                    <p class="Table_Text">subscription_item</p>
                </td>
            </tr>
            <tr>
                <td>
                    <p class="Table_Text">task</p>
                </td>
            </tr>
            <tr>
                <td>
                    <p class="Table_Text">task_management_filter</p>
                </td>
            </tr>
            <tr>
                <td>
                    <p class="Table_Text">user_access</p>
                </td>
            </tr>
            <tr>
                <td>
                    <p class="Table_Text">user_customer_association</p>
                </td>
            </tr>
            <tr>
                <td>
                    <p class="Table_Text">user_partner_group</p>
                </td>
            </tr>
            <tr>
                <td>
                    <p class="Table_Text">work_note_detail</p>
                </td>
            </tr>
            <tr>
                <td>
                    <p class="Table_Text">work_note_header</p>
                </td>
            </tr>
            <tr>
                <td>
                    <p class="Table_Text">work_ticket</p>
                </td>
            </tr>
            <tr>
                <td>
                    <p class="Table_Text">work_ticket_association</p>
                </td>
            </tr>
            <tr>
                <td>
                    <p class="Table_Text">work_ticket_audit_log</p>
                </td>
            </tr>
        </table>
        <p>Onyx recommends that a database administrator be thoroughly familiar 
 with the following resources and schedule regular rebuilding of statistics 
 and indexes according to guidelines in Microsoft SQL Server documentation.</p>
        <p style="font-weight: bold;">Microsoft maintenance resources: </p>
        <p>The following is a list of useful resources.</p>
        <ul>
            <li><em class="Emphasis" style="font-style: italic;"><a href="http://msdn2.microsoft.com/en-us/library/ms203722.aspx" target="_blank">SQL Server Books Online</a> (included with SQL Server)</em>
            </li>
            <li>SQL Server Integration Services (<a href="http://msdn2.microsoft.com/en-us/library/ms140255(d%3dide).aspx" target="_blank">SSIS</a> - for scheduling regular maintenance jobs)</li>
            <li>Microsoft SQL Server training courses. See the 
 available courses at http://www.microsoft.com</li>
        </ul>
        <p>The following list provides links to specific 
 DBCC commands that might be useful for maintaining and updating statistics, 
 rebuilding indexes, maintaining consistency, and insuring table integrity. 
 For a definitive list, see the Microsoft SQL Server documentation.</p>
        <ul style="list-style: disc;" type="disc">
            <li><a href="http://msdn2.microsoft.com/en-us/library/ms176064.aspx" target="_blank">DBCC CHECKDB</a>
            </li>
            <li><a href="http://msdn2.microsoft.com/en-us/library/ms186720.aspx" target="_blank">DBCC CHECKCATALOG</a>
            </li>
            <li><a href="http://msdn2.microsoft.com/en-us/library/ms173804.aspx" target="_blank">sp_updatestats</a>
            </li>
            <li><a href="http://msdn2.microsoft.com/en-us/library/ms188388.aspx" target="_blank">ALTER INDEX</a>
            </li>
        </ul>
        <h4>Subscription integrity script</h4>
        <p>Onyx provides a subscription integrity script in the Utilities folder 
 on the product CD. The Subscription Integrity Script is a cleanup script 
 for the subscription_item table, which tracks subscribed records and can 
 become large. The cleanup script removes logically deleted records from 
 the subscription_item table.</p>
        <h4>Restoring backed up databases</h4>
        <p>When restoring backed up OEDB databases from a different SQL Server, the 
 database administrator might run into issues with mapping SQL logins to 
 database users. Onyx security infrastructure requires three specific logins 
 to map to corresponding database users. </p>
        <p>In order to restore an OEDB database, one must map existing SQL logins 
 to existing users in the database. Onyx recommends using the SQL Server 
 sp_change_users_login command to restore the mappings.</p>
        <p class="ProcedureHeading">To restore an OEDB backup:</p>
        <ol style="list-style: decimal;list-style-type: decimal;">
            <li>Run the SQL Server restore database action. For 
 more information, see the Microsoft SQL Server documentation.</li>
            <li>After successful completion of the restore database 
 action, open a new query on the restored OEDB.</li>
            <li>Run sp_change_users_login with appropriate parameters. 
 For more information, see <a href="http://msdn2.microsoft.com/en-us/library/aa256841(SQL.80).aspx">SQL Server Books Online</a>.</li>
        </ol>
        <p class="Indent1">For example, if the database contains the 
 users OnyxDBO, OnyxEASSql, and OnyxLMSql, and you want to map them to 
 existing SQL logins with the same names, use the following syntax. If 
 the restored database uses different user names, or you want to map users 
 to a new login that does not exist, you can use different parameters and 
 values in the sp_change_users_login command. For a complete description 
 of the command syntax, see SQL Server Books Online.</p>
        <p class="Indent1">sp_change_users_login 'Auto_Fix','OnyxDBO'</p>
        <p class="Indent1">go</p>
        <p class="Indent1">sp_change_users_login 'Auto_Fix','OnyxEasSql'</p>
        <p class="Indent1">go</p>
        <p class="Indent1">sp_change_users_login 'Auto_Fix','OnyxLMSql'</p>
        <p class="Indent1">go</p>
    </body>
</html>