<!-- Copyright Aptean 2017. All rights reserved. -->
<rules xmlns="http://www.consonacrm.com/brm"
	   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	   xsi:schemaLocation="http://www.consonacrm.com/brm ../../grammar/onyx/businessRuleManager.grammar.onyx.xsd">
	<rule>
		<addNode>
			<path>
				<literal>.</literal>
			</path>
			<name>
				<literal>@path</literal>
			</name>
			<value>
				<getNodeValue>
					<literal>.</literal>
				</getNodeValue>
			</value>
		</addNode>
		<setNodeXML description="Load properties list from cache">
			<path>
				<literal>.</literal>
			</path>
			<value>
				<cacheRead>
					<name>
						<getNodeValue>
							<literal>@path</literal>
						</getNodeValue>
					</name>
				</cacheRead>
			</value>
		</setNodeXML>
		<if>
			<test>
				<not>
					<exists>
						<literal>*</literal>
					</exists>
				</not>
			</test>
			<then>
				<setNodeXML description="Load properties list from XML file">
					<path>
						<literal>.</literal>
					</path>
					<value>
						<loadXML>
							<name>
								<getNodeValue>
									<literal>@path</literal>
								</getNodeValue>
							</name>
						</loadXML>
					</value>
				</setNodeXML>
				<cacheWrite description="Write the properties list to cache">
					<name>
						<getNodeValue>
							<literal>@path</literal>
						</getNodeValue>
					</name>
					<value>
						<getNodeXML>
							<literal>*</literal>
						</getNodeXML>
					</value>
				</cacheWrite>
			</then>
			<else>
				<addNode mode="development">
					<path>
						<literal>.</literal>
					</path>
					<name>
						<literal>@cache</literal>
					</name>
					<value>
						<literal>1</literal>
					</value>
				</addNode>
			</else>
		</if>
		<removeNodes>
			<path>
				<literal>.</literal>
			</path>
			<name>
				<literal>@path</literal>
			</name>
		</removeNodes>
	</rule>
</rules>
